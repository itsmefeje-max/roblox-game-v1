-- used for the sprinting system for my game for all devices\
local ContextActionService = game:GetService("ContextActionService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- === SETTINGS ===
local WALK_SPEED = 20
local SPRINT_SPEED = 35
local ANIMATION_ID = "rbxassetid://103489308479400" -- Your Animation ID
local ACTION_NAME = "SprintAction"

-- === VARIABLES ===
local runTrack = nil
local isSprinting = false -- Keeps track of the toggle state

-- Function to load animation
local function setupAnimation(character)
	local humanoid = character:WaitForChild("Humanoid")
	local animator = humanoid:WaitForChild("Animator")

	local newAnim = Instance.new("Animation")
	newAnim.AnimationId = ANIMATION_ID

	runTrack = animator:LoadAnimation(newAnim)
	runTrack.Priority = Enum.AnimationPriority.Action
	runTrack.Looped = true
end

-- Function to manage animation based on speed
local function updateMovement(humanoid)
	local isMoving = humanoid.MoveDirection.Magnitude > 0
	local isFast = humanoid.WalkSpeed > WALK_SPEED

	if isFast and isMoving then
		if not runTrack.IsPlaying then
			runTrack:Play()
		end
	else
		if runTrack and runTrack.IsPlaying then
			runTrack:Stop()
		end
	end
end

-- === MAIN INPUT HANDLER (PC TOGGLE) ===
local function handleSprint(actionName, inputState, inputObject)
	local character = player.Character
	if not character then return end
	local humanoid = character:FindFirstChild("Humanoid")
	if not humanoid then return end

	-- ðŸ›‘ NEW CHECK: If holding a tool, DO NOT allow sprinting
	if character:FindFirstChildWhichIsA("Tool") then
		isSprinting = false
		humanoid.WalkSpeed = WALK_SPEED
		updateMovement(humanoid)
		return 
	end

	-- LOGIC: We only care when the key is PRESSED DOWN (Begin)
	if inputState == Enum.UserInputState.Begin then

		-- Flip the switch: If On -> Off. If Off -> On.
		isSprinting = not isSprinting

		if isSprinting then
			humanoid.WalkSpeed = SPRINT_SPEED
		else
			humanoid.WalkSpeed = WALK_SPEED
		end

		-- Update animation instantly
		updateMovement(humanoid)
	end
end

-- === CONNECTIONS ===
local function onCharacterAdded(character)
	isSprinting = false -- Reset toggle when respawning
	setupAnimation(character)
	local humanoid = character:WaitForChild("Humanoid")

	-- ðŸ›‘ NEW CONNECTION: If they equip a tool while running, FORCE STOP
	character.ChildAdded:Connect(function(child)
		if child:IsA("Tool") then
			isSprinting = false
			humanoid.WalkSpeed = WALK_SPEED
			updateMovement(humanoid)
		end
	end)

	humanoid:GetPropertyChangedSignal("MoveDirection"):Connect(function()
		updateMovement(humanoid)
	end)

	humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
		updateMovement(humanoid)
	end)
end

if player.Character then
	onCharacterAdded(player.Character)
end
player.CharacterAdded:Connect(onCharacterAdded)

-- Bind Action (False = No default mobile button)
ContextActionService:BindAction(ACTION_NAME, handleSprint, false, Enum.KeyCode.LeftShift)
