-- gives the ability for players to put the car onto pads 

local ServerStorage = game:GetService("ServerStorage")
local Workspace = game:GetService("Workspace")

-- === ‚öôÔ∏è TUNING ===
local VERTICAL_OFFSET = 0  -- Lowers the car by 1 stud (Fixes the floating!)
local GHOST_TIME = 2        -- How long the car stays non-collide (so you don't get stuck)
-- =================

-- üìÅ FOLDERS
local LuxuryFolder = Workspace:WaitForChild("Luxury-Pads")
local NormalFolder = Workspace:WaitForChild("Normal-Pads")
local CarModels = ServerStorage:WaitForChild("CarModels")

-- üõ†Ô∏è SETUP FUNCTION
local function setupPad(pad)
	if not pad:IsA("BasePart") then return end

	-- 1. PROXIMITY PROMPT
	local prompt = pad:FindFirstChild("ProximityPrompt")
	if not prompt then
		prompt = Instance.new("ProximityPrompt")
		prompt.ActionText = "Place Car"
		prompt.ObjectText = "Car Pad"
		prompt.HoldDuration = 0.5
		prompt.MaxActivationDistance = 10
		prompt.RequiresLineOfSight = false
		prompt.Parent = pad
	end

	-- 2. OCCUPIED TAG
	local occupiedVal = pad:FindFirstChild("IsOccupied")
	if not occupiedVal then
		occupiedVal = Instance.new("BoolValue")
		occupiedVal.Name = "IsOccupied"
		occupiedVal.Value = false
		occupiedVal.Parent = pad
	end

	-- 3. THE INTERACTION EVENT
	prompt.Triggered:Connect(function(player)

		if occupiedVal.Value == true then return end

		local character = player.Character
		local tool = character:FindFirstChildWhichIsA("Tool")

		if tool then
			local carName = tool.Name:gsub(" Item", "")
			local realCar = CarModels:FindFirstChild(carName)

			if realCar then
				-- A. REMOVE TOOL
				tool:Destroy()

				-- B. PLACE CAR
				local placedCar = realCar:Clone()

				-- üìê POSITIONING (With Vertical Adjustment)
				-- We add the VERTICAL_OFFSET to fix the floating gap
				local padTop = pad.CFrame * CFrame.new(0, (pad.Size.Y / 2) + VERTICAL_OFFSET, 0)
				placedCar:PivotTo(padTop)
				placedCar.Parent = pad

				-- C. "FRESH PAINT" MODE (Ghost Physics)
				-- We make it CanCollide = FALSE first so you can walk out!
				for _, part in pairs(placedCar:GetDescendants()) do
					if part:IsA("BasePart") then
						part.Anchored = true
						part.CanCollide = false -- Ghost mode!
					end
				end

				-- D. UPDATE STATUS
				occupiedVal.Value = true
				prompt.Enabled = false 

				-- E. MONEY TAGS
				local carTag = Instance.new("StringValue")
				carTag.Name = carName
				carTag.Parent = player:WaitForChild("OwnedCars")

				local tagLink = Instance.new("ObjectValue")
				tagLink.Name = "MoneyTag"
				tagLink.Value = carTag
				tagLink.Parent = placedCar

				print("Placed: " .. carName)

				-- F. "DRY THE PAINT" (Make Solid after 2 seconds)
				task.delay(GHOST_TIME, function()
					if placedCar then
						for _, part in pairs(placedCar:GetDescendants()) do
							if part:IsA("BasePart") then
								part.CanCollide = true -- Solid!
							end
						end
					end
				end)
			end
		end
	end)
end

-- üîÑ LOOP THROUGH PADS
for _, pad in pairs(LuxuryFolder:GetChildren()) do setupPad(pad) end
for _, pad in pairs(NormalFolder:GetChildren()) do setupPad(pad) end
